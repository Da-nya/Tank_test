<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body{
        margin: 0;
        background-color:ivory;
        }
        .game-window{
        width: 800px;
        height: 800px;
        margin: 0 auto;
        background-color:rgba(0, 0, 0, 0.733);
        }
        h1{
         text-align: center;
        }
        canvas{
        width: 100%;
        height: 100%;
        }
        .interface{
            width: 800px;
            height: 50px;
            margin: 0 auto;
            background-color: black;
        }
        .info{
            position: absolute;
            top: 20px;
            left: 20px
        }
        p{
            font-size: 17px;
        }
        .drops{
            margin-top: 50px;
        }
        .info-img{
            width: 50px;
            height:50px;
        }
        .tank1{
            fill: #1d84fa;
        }
        .tank2{
            fill: #da1d1d;
        }
    </style>
    <svg display="none"> 
        <symbol id="bomba" viewBox="0 0 512 512">
            <path style="fill:#464655;" d="M260.423,79.067H189.65c-4.886,0-8.847,3.961-8.847,8.847v39.81h88.467v-39.81
                        C269.27,83.028,265.309,79.067,260.423,79.067z" />
            <circle style="fill:#5B5D6E;" cx="225.037" cy="309.08" r="194.626" />
            <path style="fill:#464655;" d="M290.649,438.094c-107.489,0-194.626-87.137-194.626-194.626c0-36.928,10.285-71.452,28.146-100.867
                        C67.962,176.727,30.41,238.518,30.41,309.08c0,107.489,87.137,194.626,194.626,194.626c70.562,0,132.353-37.552,166.481-93.759
                        C362.101,427.809,327.577,438.094,290.649,438.094z" />
            <circle style="fill:#FFF082;" cx="428.51" cy="96.76" r="44.233" />
            <path
                d="M428.51,88.467h-70.773c-19.816,0-35.94-16.122-35.94-35.94C321.797,23.564,298.233,0,269.27,0
                        c-28.963,0-52.527,23.564-52.527,52.527v18.246H189.65c-9.452,0-17.14,7.689-17.14,17.14v25.154
                        C86.001,136.272,22.117,215.35,22.117,309.08c0,111.89,91.03,202.92,202.92,202.92s202.92-91.03,202.92-202.92
                        c0-93.73-63.884-172.808-150.393-196.012V87.914c0-9.452-7.689-17.14-17.14-17.14H233.33V52.527c0-19.818,16.123-35.94,35.94-35.94
                        s35.94,16.122,35.94,35.94c0,28.963,23.564,52.527,52.527,52.527h70.773c4.58,0,8.294-3.713,8.294-8.294
                        S433.09,88.467,428.51,88.467z M411.369,309.08c0,102.744-83.589,186.333-186.333,186.333S38.704,411.824,38.704,309.08
                        s83.589-186.333,186.333-186.333S411.369,206.336,411.369,309.08z M260.976,87.914v21.434c-11.668-2.094-23.678-3.188-35.94-3.188
                        s-24.272,1.094-35.94,3.188V87.914c0-0.304,0.248-0.553,0.553-0.553h70.773C260.729,87.361,260.976,87.609,260.976,87.914z" />
            <path d="M481.59,88.467h-17.693c-4.58,0-8.294,3.713-8.294,8.294s3.713,8.294,8.294,8.294h17.693c4.58,0,8.294-3.713,8.294-8.294
                        S486.17,88.467,481.59,88.467z" />
            <path d="M428.51,35.387c-4.58,0-8.294,3.713-8.294,8.294v17.693c0,4.58,3.713,8.294,8.294,8.294s8.294-3.713,8.294-8.294V43.68
                        C436.803,39.1,433.09,35.387,428.51,35.387z" />
            <path d="M428.51,123.853c-4.58,0-8.294,3.713-8.294,8.294v17.693c0,4.58,3.713,8.294,8.294,8.294s8.294-3.713,8.294-8.294v-17.693
                        C436.803,127.567,433.09,123.853,428.51,123.853z" />
            <path
                d="M459.397,115.918c-3.239-3.239-8.491-3.239-11.728,0c-3.239,3.239-3.239,8.491,0,11.728l12.51,12.51
                        c1.619,1.62,3.742,2.43,5.864,2.43s4.245-0.809,5.864-2.43c3.239-3.239,3.239-8.491,0-11.73L459.397,115.918z" />
            <path d="M397.623,77.603c1.619,1.62,3.742,2.43,5.864,2.43s4.245-0.809,5.864-2.43c3.239-3.239,3.239-8.491,0-11.728l-12.51-12.51
                        c-3.239-3.24-8.491-3.239-11.728,0c-3.239,3.239-3.239,8.491,0,11.73L397.623,77.603z" />
            <path d="M397.623,115.918l-12.51,12.51c-3.239,3.239-3.239,8.491,0,11.73c1.619,1.619,3.742,2.43,5.864,2.43s4.245-0.809,5.864-2.43
                        l12.51-12.51c3.239-3.239,3.239-8.491,0-11.728C406.113,112.68,400.862,112.679,397.623,115.918z" />
            <path d="M453.531,80.032c2.122,0,4.245-0.809,5.864-2.43l12.51-12.51c3.239-3.239,3.239-8.491,0-11.73
                        c-3.239-3.239-8.491-3.239-11.728,0l-12.51,12.51c-3.239,3.239-3.239,8.491,0,11.728C449.287,79.223,451.409,80.032,453.531,80.032z
                        " />
            <path d="M283.78,169.988c5.717,2.418,11.347,5.224,16.731,8.339c1.308,0.756,2.736,1.116,4.146,1.116
                        c2.863,0,5.65-1.485,7.187-4.142c2.293-3.964,0.94-9.038-3.026-11.333c-5.978-3.458-12.228-6.573-18.578-9.258
                        c-4.218-1.784-9.084,0.19-10.869,4.408C277.587,163.338,279.56,168.204,283.78,169.988z" />
            <path d="M191.486,456.286c-33.973-7.71-64.492-27.226-85.934-54.955c-2.802-3.623-8.01-4.29-11.634-1.487
                        c-3.624,2.802-4.29,8.011-1.487,11.634c23.792,30.768,57.667,52.425,95.386,60.984c0.618,0.14,1.235,0.208,1.843,0.208
                        c3.787,0,7.208-2.611,8.08-6.46C198.752,461.742,195.953,457.299,191.486,456.286z" />
            <path d="M325.653,196.556c21.228,18.996,36.594,43.414,44.438,70.615c1.048,3.634,4.364,5.998,7.965,5.998
                        c0.761,0,1.534-0.105,2.302-0.326c4.401-1.27,6.94-5.866,5.671-10.268c-8.708-30.2-25.761-57.303-49.315-78.379
                        c-3.414-3.054-8.658-2.765-11.711,0.65C321.948,188.259,322.239,193.502,325.653,196.556z" />
        </symbol>
        <symbol id="heart" viewBox="0 0 486.4 486.4">
            <g>
                <g>
                    <g>
                        <path style="fill:#D71920;" d="M243.2,438.476l188.9-182.118c25.243-27.026,44.8-56.565,44.8-90.532
                                        c0-65.116-52.787-117.903-117.903-117.903c-57.509,0-105.393,41.177-115.797,95.655c-10.405-54.477-58.288-95.655-115.797-95.655
                                        C62.287,47.924,9.5,100.71,9.5,165.826c0,33.967,19.557,63.507,44.8,90.532L243.2,438.476z" />
                        <path
                            d="M243.2,447.977c-2.377,0-4.754-0.887-6.593-2.661L47.706,263.198c-0.12-0.115-0.236-0.233-0.349-0.355
                                        C27.028,241.078,0,207.341,0,165.826C0,95.576,57.153,38.424,127.403,38.424c50.61,0,95.424,29.866,115.797,74.191
                                        c20.373-44.325,65.187-74.191,115.797-74.191c70.25,0,127.403,57.153,127.403,127.403c0,41.514-27.028,75.252-47.357,97.017
                                        c-0.113,0.122-0.229,0.24-0.349,0.355L249.793,445.316C247.954,447.09,245.577,447.977,243.2,447.977z M61.074,249.694
                                        L243.2,425.28l182.126-175.586c28.703-30.779,42.074-57.433,42.074-83.868c0-59.773-48.629-108.403-108.403-108.403
                                        c-51.959,0-96.734,36.983-106.466,87.937c-0.855,4.479-4.771,7.718-9.331,7.718s-8.476-3.239-9.331-7.718
                                        c-9.732-50.954-54.507-87.937-106.466-87.937C67.629,57.424,19,106.053,19,165.826C19,192.261,32.371,218.916,61.074,249.694z" />
                    </g>
                    <g>
                        <path d="M377.149,267.9c-2.378,0-4.758-0.887-6.603-2.671l-9.731-9.41c-3.772-3.647-3.873-9.661-0.225-13.433
                                        c3.647-3.771,9.661-3.872,13.433-0.225l9.731,9.41c3.772,3.647,3.873,9.661,0.225,13.433
                                        C382.115,266.931,379.634,267.9,377.149,267.9z" />
                    </g>
                    <g>
                        <path
                            d="M303.204,322.704c-2.432,0-4.862-0.927-6.718-2.782l-92.762-92.763l-14.783,14.783l-11.063,11.611
                                        c-3.62,3.798-9.631,3.945-13.432,0.325c-3.798-3.619-3.944-9.633-0.325-13.431l11.143-11.695c0.053-0.056,0.107-0.11,0.16-0.165
                                        l21.581-21.58c3.713-3.71,9.726-3.709,13.435,0l92.762,92.763l30.178-30.178c3.713-3.71,9.726-3.71,13.435,0
                                        c3.71,3.71,3.71,9.725,0,13.435l-36.896,36.896C308.066,321.777,305.636,322.704,303.204,322.704z" />
                    </g>
                    <g>
                        <path d="M145.299,281.648H130.15c-5.246,0-9.5-4.253-9.5-9.5s4.254-9.5,9.5-9.5h15.149c5.246,0,9.5,4.253,9.5,9.5
                                        S150.545,281.648,145.299,281.648z" />
                    </g>
                </g>
                <path d="M164.346,100.576c-1.224,0-2.468-0.238-3.666-0.74c-9.166-3.839-18.9-5.786-28.932-5.786c-5.246,0-9.5-4.253-9.5-9.5
                                s4.254-9.5,9.5-9.5c12.566,0,24.771,2.443,36.273,7.261c4.84,2.027,7.119,7.594,5.092,12.433
                                C171.587,98.384,168.06,100.576,164.346,100.576z" />
                <path d="M47.304,178.493c-5.246,0-9.5-4.253-9.5-9.5c0-17.983,5.1-35.463,14.747-50.549C61.936,103.767,75.169,92,90.816,84.415
                                c4.719-2.287,10.404-0.317,12.693,4.405c2.288,4.721,0.316,10.404-4.405,12.692c-26.092,12.647-42.3,38.505-42.3,67.482
                                C56.804,174.24,52.551,178.493,47.304,178.493z" />
            </g>
        </symbol>
        <symbol id="tank-right" viewBox="0 0 20 20">
            <circle cx="10" cy="10" r="4"/>
            <rect x="10" y="9" width="10" height="2"/>
        </symbol>
        <symbol id="tank-left" viewBox="0 0 20 20">
            <circle cx="10" cy="10" r="4"/>
            <rect x="0" y="9" width="10" height="2"/>
        </symbol>
        <symbol id="tank-down" viewBox="0 0 20 20">
            <circle cx="10" cy="10" r="4"/>
            <rect x="9" y="10" width="2" height="10"/>
        </symbol>
        <symbol id="tank-up" viewBox="0 0 20 20">
            <circle cx="10" cy="10" r="4"/>
            <rect x="9" y="0" width="2" height="10"/>
        </symbol>
        <symbol id="grass" viewBox="0 0 512 512">
            <rect x="0" y="0" width="512" height="512" fill="none" stroke="#91DC5A" stroke-width="1"/>
            <path style="fill:#47821C;" d="M8.947,309.628c2.735-5.803,9.057-9.009,15.355-7.787c32.473,6.296,66.997,22.41,102.611,47.894
                        	c27.931,19.986,56.691,45.812,85.481,76.76c0.228,0.245,0.452,0.489,0.679,0.734h-97.325c-9.586-10.639-18.719-20.377-27.1-29.061
                        	c-42.577-44.109-75.611-71.47-75.938-71.74C7.762,322.348,6.213,315.43,8.947,309.628z" />
            <path style="fill:#4E901E;" d="M31.411,205.472c3.883-5.107,10.734-6.928,16.639-4.422c30.453,12.915,60.868,35.86,90.401,68.196
                        	c23.161,25.36,45.918,56.605,67.639,92.866c14.166,23.65,25.974,46.197,35.193,65.117H155.36
                        	c-21.473-46.557-45.252-87.88-64.414-118.572c-32.467-52.003-59.085-85.638-59.349-85.97
                        	C27.606,217.665,27.529,210.577,31.411,205.472z" />
            <path style="fill:#5EAC24;" d="M85.789,126.161c4.746-4.317,11.812-4.864,17.165-1.328c27.602,18.23,53.345,46.314,76.517,83.476
                        	c18.172,29.144,34.878,64.001,49.654,103.603c18.858,50.543,29.609,95.304,33.953,115.317h-82.56
                        	c-12.849-73.029-36.419-141.872-54.917-188.788c-22.486-57.034-42.555-94.943-42.754-95.317
                        	C79.832,137.462,81.044,130.477,85.789,126.161z" />
            <path style="fill:#6DC82A;" d="M206.209,427.145c0.002-0.497,0.029-0.986,0.081-1.469c4.802-82.815-5.741-166.033-15.448-221.327
                        	c-10.59-60.328-22.511-101.427-22.63-101.834c-1.796-6.141,0.687-12.754,6.031-16.06c5.345-3.307,12.185-2.463,16.616,2.051
                        	c22.845,23.271,42.045,55.845,57.066,96.816c11.781,32.133,21.078,69.582,27.631,111.308c10.976,69.873,10.541,127.261,10.5,130.88
                        	L206.209,427.145z" />
            <path style="fill:#4E901E;" d="M503.053,309.628c-2.735-5.803-9.057-9.009-15.355-7.787c-32.473,6.296-66.997,22.41-102.611,47.894
                        	c-27.931,19.986-56.691,45.812-85.481,76.76c-0.228,0.245-0.452,0.489-0.679,0.734h97.325c9.586-10.639,18.719-20.377,27.1-29.061
                        	c42.577-44.109,75.611-71.47,75.938-71.74C504.237,322.348,505.787,315.43,503.053,309.628z" />
            <path style="fill:#5EAC24;" d="M480.589,205.472c-3.883-5.107-10.734-6.928-16.639-4.422c-30.453,12.915-60.868,35.86-90.401,68.196
                        	c-23.161,25.36-45.918,56.605-67.639,92.866c-14.166,23.65-25.974,46.197-35.193,65.117h85.922
                        	c21.473-46.557,45.252-87.88,64.414-118.572c32.467-52.003,59.085-85.638,59.349-85.97
                        	C484.394,217.665,484.471,210.577,480.589,205.472z" />
            <path style="fill:#6DC82A;" d="M426.212,126.161c-4.746-4.317-11.812-4.864-17.165-1.328c-27.602,18.23-53.346,46.314-76.517,83.476
                        	c-18.172,29.144-34.878,64.001-49.654,103.603c-18.858,50.543-29.609,95.304-33.953,115.317h82.56
                        	c12.849-73.029,36.419-141.872,54.917-188.788c22.486-57.034,42.555-94.943,42.754-95.317
                        	C432.168,137.462,430.956,130.477,426.212,126.161z" />
            <path style="fill:#91DC5A;" d="M307.304,427.228c0-0.497-0.026-0.986-0.076-1.469c-4.549-82.835,6.689-166.005,16.935-221.255
                        	c11.179-60.279,23.637-101.323,23.76-101.728c1.877-6.133-0.648-12.757-6.129-16.088c-5.483-3.331-12.524-2.518-17.103,1.975
                        	c-23.611,23.166-43.517,55.651-59.163,96.555c-12.272,32.078-22.012,69.485-28.95,111.18
                        	c-11.621,69.823-11.443,127.211-11.42,130.831h82.145V427.228z" />
            <g>
                <path style="fill:#5EAC24;" d="M279.06,282.59c-0.396,0-0.798-0.03-1.202-0.095c-4.148-0.658-6.975-4.555-6.316-8.703
                        		c3.62-22.796,6.991-36.936,7.133-37.527c0.98-4.083,5.084-6.596,9.166-5.62c4.083,0.979,6.6,5.083,5.622,9.166
                        		c-0.032,0.14-3.383,14.21-6.902,36.367C285.966,279.921,282.734,282.59,279.06,282.59z" />
                <path style="fill:#5EAC24;" d="M270.716,397.043c-4.119,0-7.503-3.29-7.599-7.428c-0.594-25.769,0.707-53.348,3.868-81.97
                        		c0.461-4.172,4.22-7.174,8.393-6.724c4.174,0.461,7.184,4.219,6.724,8.393c-3.088,27.954-4.361,54.853-3.781,79.95
                        		c0.097,4.198-3.228,7.68-7.426,7.777C270.835,397.042,270.775,397.043,270.716,397.043z" />
            </g>
            <path d="M28.899,419.625h-13.18c-4.199,0-7.604,3.403-7.604,7.604s3.404,7.604,7.604,7.604h13.18c4.199,0,7.604-3.403,7.604-7.604
                        	S33.098,419.625,28.899,419.625z" />
            <path d="M495.615,419.625h-29.749c-4.2,0-7.604,3.403-7.604,7.604s3.403,7.604,7.604,7.604h29.749c4.2,0,7.604-3.403,7.604-7.604
                        	S499.815,419.625,495.615,419.625z" />
            <path d="M509.931,306.387c-4.223-8.957-13.958-13.901-23.679-12.012c-19.742,3.827-40.243,11.165-61.203,21.886
                        	c29.326-47.098,55.604-81.421,56.079-82.037c3.334-4.412,5.212-6.784,5.229-6.806c6.16-7.751,6.278-18.668,0.285-26.55
                        	c-5.994-7.884-16.546-10.692-25.659-6.82c-22.152,9.394-44.233,23.893-65.929,43.208c21.605-54.219,40.623-90.199,40.814-90.561
                        	c4.654-8.74,2.787-19.497-4.538-26.16c-7.323-6.663-18.21-7.505-26.474-2.049c-25.234,16.666-48.887,41.186-70.451,72.996
                        	c10.247-51.647,20.677-86.116,20.789-86.482c2.897-9.467-0.796-20.003-9.451-24.811c-10.831-6.015-22.17-0.801-26.377,3.046
                        	c-35.738,32.675-62.113,102.385-62.693,103.958c-0.533-1.506-29.82-74.576-60.387-104.014c-7.136-6.873-17.65-8.386-26.043-3.191
                        	c-8.247,5.102-12.083,15.242-9.329,24.66c0.114,0.388,11.008,37.994,21.163,93.876c-22.758-35.114-47.942-61.93-74.932-79.755
                        	c-8.262-5.46-19.148-4.615-26.473,2.049c-7.324,6.662-9.191,17.42-4.513,26.209c0.39,0.72,20.136,37.483,41.821,91.405
                        	c-22.027-19.774-44.459-34.558-66.96-44.101c-9.116-3.867-19.668-1.063-25.661,6.821c-5.993,7.881-5.874,18.798,0.286,26.549
                        	c0.263,0.331,36.711,47.169,60.716,88.277c-20.753-10.556-41.057-17.809-60.611-21.6c-9.721-1.895-19.459,3.053-23.68,12.01
                        	c-4.222,8.955-1.835,19.609,5.798,25.904c0.327,0.271,33.234,27.568,75.31,71.16c5.123,5.307,10.235,10.719,15.301,16.176H54.92
                        	c-4.199,0-7.604,3.403-7.604,7.604s3.404,7.604,7.604,7.604h60.829h0.001c0,0,8.184,0.279,7.774-7.322
                        	c-0.338-6.263-20.121-25.003-29.405-34.624c-42.731-44.277-76.233-72.047-76.572-72.326c-2.267-1.871-2.976-5.032-1.723-7.691
                        	c1.253-2.657,4.143-4.129,7.029-3.565c25.196,4.885,51.918,16.031,79.433,33.114c17.256,29.558,32.729,59.138,46.167,88.276
                        	c1.243,2.693,3.938,4.418,6.905,4.418h23.082c2.183,0,4.26-0.938,5.704-2.575s2.114-3.817,1.84-5.982
                        	C168.269,286.38,90.317,141.232,89.558,139.832c-1.381-2.594-0.826-5.787,1.348-7.765c2.175-1.978,5.431-2.266,7.857-0.609
                        	c47.742,32.61,76.806,78.571,90.097,108.554c7.565,52.066,13.677,118.721,9.848,185.061c-0.066,0.678-0.625,9.438,7.466,9.673
                        	l125.31,0.084c3.691,0,6.85-2.65,7.489-6.286c10.3-58.539,27.605-114.371,43.199-157.418c27.835-29.805,56.342-51.033,84.748-63.079
                        	c2.703-1.148,5.837-0.315,7.615,2.024c1.779,2.341,1.745,5.581-0.082,7.88c-0.019,0.022-84.287,107.149-123.112,206.446
                        	c-0.92,2.351-0.655,4.999,0.759,7.09c1.414,2.092,3.774,3.344,6.298,3.344h80.431c4.2,0,7.604-3.403,7.604-7.604
                        	c0-4.2-3.403-7.604-7.604-7.604h-25.309c5.063-5.452,10.174-10.864,15.301-16.176c41.953-43.463,74.985-70.891,75.304-71.155
                        	C511.765,325.996,514.153,315.341,509.931,306.387z M130.549,272.172c0.171,0.185,0.35,0.359,0.534,0.522
                        	c16.065,44.315,31.286,95.915,38.658,147.213h-9.529c-17.756-37.985-38.875-76.649-62.816-114.995
                        	c-32.828-52.581-59.582-86.342-59.846-86.675c-1.829-2.301-1.863-5.542-0.085-7.881c1.779-2.341,4.91-3.172,7.617-2.025
                        	C73.731,220.483,102.487,241.961,130.549,272.172z M198.332,203.034c-10.7-60.956-22.702-102.245-22.821-102.653
                        	c-0.841-2.876,0.283-5.944,2.733-7.46c2.306-1.423,5.262-1.052,7.189,0.911c22.084,22.495,40.707,54.158,55.353,94.106
                        	c2.716,7.408,5.328,15.218,7.78,23.219c-26.53,84.204-30.659,190.003-30.955,208.434l-3.382-0.015
                        	C218.173,338.19,207.845,257.228,198.332,203.034z M232.819,419.625c0.293-18.075,1.973-66.181,11.26-121.979
                        	c6.857-41.197,16.463-78.11,28.552-109.712c15.253-39.875,34.561-71.448,57.388-93.844c1.208-1.185,4.219-2.85,7.829-0.904
                        	c2.587,1.394,3.665,4.554,2.804,7.372c-0.127,0.415-12.751,42.1-23.963,102.56c-10.043,54.155-21.051,135.086-17.379,216.507
                        	L232.819,419.625L232.819,419.625z M325.129,419.625h-10.591c-3.129-67.788,4.153-135.419,12.477-187.051
                        	c0.214-0.284,41.773-78.389,86.219-101.396c2.613-1.352,5.685-1.371,7.859,0.608s2.727,5.171,1.345,7.767
                        	C422.239,139.934,357.385,245.177,325.129,419.625z M494.442,320.569c-1.37,1.132-34.023,28.247-76.564,72.319
                        	c-8.426,8.729-16.827,17.713-25.005,26.738h-23.087c11.203-26.132,25.104-52.479,39.25-76.79v-0.001
                        	c27.754-17.323,54.706-28.604,80.111-33.529c2.878-0.557,5.774,0.906,7.028,3.567C497.428,315.529,496.719,318.691,494.442,320.569z
                        	" />
            </symbol>
        <symbol id="wall" viewBox="0 0 511.999 511.999">
            <rect x="9.906" y="9.264" style="fill:#FCD577;" width="493.474" height="493.474" />
            <path d="M502.736,0H354.821c-5.116,0-9.264,4.148-9.264,9.264s4.148,9.264,9.264,9.264h40.733v80.167h-179.25V18.528H323.94
                        	c5.116,0,9.264-4.148,9.264-9.264S329.057,0,323.941,0H9.264C4.148,0,0,4.148,0,9.264v98.695v98.694v98.694v98.695v98.694
                        	c0,5.116,4.148,9.264,9.264,9.264h493.471c5.116,0,9.264-4.148,9.264-9.264V9.264C512,4.148,507.852,0,502.736,0z M395.554,413.305
                        	v80.166h-179.25v-80.166H395.554z M314.222,394.777V314.61h179.248v80.167H314.222z M18.528,296.083v-80.166h179.248v80.166H18.528z
                        	 M18.528,394.777V314.61h79.39v80.167H18.528z M295.694,117.223v80.166H116.446v-80.166H295.694z M97.918,197.389h-79.39v-80.166
                        	h79.39V197.389z M216.304,215.917h126.163c5.116,0,9.264-4.148,9.264-9.264s-4.148-9.264-9.264-9.264h-28.245v-80.166h179.248
                        	v80.166H373.348c-5.116,0-9.264,4.148-9.264,9.264c0,5.116,4.148,9.264,9.264,9.264h22.206v80.166h-179.25V215.917z
                        	 M493.472,215.917v80.166h-79.39v-80.166H493.472z M414.082,18.528h79.39v80.167h-79.39V18.528z M197.776,98.695H18.528V18.528
                        	h179.248V98.695z M18.528,413.305h133.719c5.116,0,9.264-4.148,9.264-9.264c0-5.116-4.148-9.264-9.264-9.264h-35.801V314.61h179.248
                        	v80.167H183.127c-5.116,0-9.264,4.148-9.264,9.264c0,5.116,4.148,9.264,9.264,9.264h14.649v80.166H18.528V413.305z M414.082,493.472
                        	v-80.166h79.39v80.166H414.082z" />
            </symbol>
        <symbol id="water" viewBox="0 0 32 32">
            <rect x="0" y="0" width="32" height="32" fill="none" stroke="#32b2ff" stroke-width="1"/>
            <path
                d="M8.622,22.953c0.022,-0.234 0.205,-0.424 0.443,-0.45c0.253,-0.028 0.487,0.139 0.543,0.388c0.378,1.695 1.642,3.338 3.556,3.002c0.329,-0.058 0.654,-0.223 0.907,-0.438c0.778,-0.661 1.189,-1.617 1.446,-2.583c0.064,-0.243 0.299,-0.4 0.548,-0.368c0.237,0.031 0.417,0.225 0.434,0.461c0.39,1.678 1.649,3.289 3.545,2.955c0.33,-0.058 0.654,-0.223 0.907,-0.438c0.778,-0.66 1.19,-1.617 1.446,-2.583c0.059,-0.222 0.263,-0.376 0.493,-0.371c0.231,0.004 0.428,0.166 0.478,0.391c0.379,1.695 1.643,3.338 3.556,3.001c0.33,-0.058 0.654,-0.223 0.907,-0.438c0.778,-0.66 1.19,-1.617 1.446,-2.583c0.071,-0.266 0.345,-0.425 0.612,-0.355c0.267,0.071 0.426,0.345 0.355,0.612c-0.308,1.161 -0.83,2.295 -1.765,3.089c-0.385,0.326 -0.88,0.572 -1.381,0.66c-1.943,0.342 -3.43,-0.818 -4.218,-2.393c-0.307,0.655 -0.719,1.255 -1.282,1.733c-0.384,0.326 -0.88,0.572 -1.381,0.66c-1.948,0.343 -3.437,-0.825 -4.224,-2.407c-0.306,0.65 -0.717,1.245 -1.275,1.719c-0.384,0.327 -0.88,0.572 -1.381,0.661c-1.938,0.341 -3.421,-0.812 -4.211,-2.38c-0.307,0.66 -0.722,1.266 -1.288,1.747c-0.385,0.326 -0.88,0.572 -1.381,0.66c-2.479,0.436 -4.215,-1.572 -4.706,-3.768c-0.06,-0.27 0.11,-0.537 0.379,-0.597c0.27,-0.061 0.537,0.109 0.597,0.379c0.379,1.695 1.643,3.338 3.556,3.001c0.33,-0.058 0.654,-0.223 0.907,-0.438c0.764,-0.648 1.174,-1.581 1.432,-2.529Z"
                style="fill:#32b2ff;" />
            <path
                d="M8.622,16.953c0.022,-0.234 0.205,-0.424 0.443,-0.45c0.253,-0.028 0.487,0.139 0.543,0.388c0.378,1.695 1.642,3.338 3.556,3.002c0.329,-0.058 0.654,-0.223 0.907,-0.438c0.778,-0.661 1.189,-1.617 1.446,-2.583c0.064,-0.243 0.299,-0.4 0.548,-0.368c0.237,0.031 0.417,0.225 0.434,0.461c0.39,1.678 1.649,3.289 3.545,2.955c0.33,-0.058 0.654,-0.223 0.907,-0.438c0.778,-0.66 1.19,-1.617 1.446,-2.583c0.059,-0.222 0.263,-0.376 0.493,-0.371c0.231,0.004 0.428,0.166 0.478,0.391c0.379,1.695 1.643,3.338 3.556,3.001c0.33,-0.058 0.654,-0.223 0.907,-0.438c0.778,-0.66 1.19,-1.617 1.446,-2.583c0.071,-0.266 0.345,-0.425 0.612,-0.355c0.267,0.071 0.426,0.345 0.355,0.612c-0.308,1.161 -0.83,2.295 -1.765,3.089c-0.385,0.326 -0.88,0.572 -1.381,0.66c-1.943,0.342 -3.43,-0.818 -4.218,-2.393c-0.307,0.655 -0.719,1.255 -1.282,1.733c-0.384,0.326 -0.88,0.572 -1.381,0.66c-1.948,0.343 -3.437,-0.825 -4.224,-2.407c-0.306,0.65 -0.717,1.245 -1.275,1.719c-0.384,0.327 -0.88,0.572 -1.381,0.661c-1.938,0.341 -3.421,-0.812 -4.211,-2.38c-0.307,0.66 -0.722,1.266 -1.288,1.747c-0.385,0.326 -0.88,0.572 -1.381,0.66c-2.479,0.436 -4.215,-1.572 -4.706,-3.768c-0.06,-0.27 0.11,-0.537 0.379,-0.597c0.27,-0.061 0.537,0.109 0.597,0.379c0.379,1.695 1.643,3.338 3.556,3.001c0.33,-0.058 0.654,-0.223 0.907,-0.438c0.764,-0.648 1.174,-1.581 1.432,-2.529Z"
                style="fill:#32b2ff;" />
            <path
                d="M8.622,10.953c0.022,-0.234 0.205,-0.424 0.443,-0.45c0.253,-0.028 0.487,0.139 0.543,0.388c0.378,1.695 1.642,3.338 3.556,3.002c0.329,-0.058 0.654,-0.223 0.907,-0.438c0.778,-0.661 1.189,-1.617 1.446,-2.583c0.064,-0.243 0.299,-0.4 0.548,-0.368c0.237,0.031 0.417,0.225 0.434,0.461c0.39,1.678 1.649,3.289 3.545,2.955c0.33,-0.058 0.654,-0.223 0.907,-0.438c0.778,-0.66 1.19,-1.617 1.446,-2.583c0.059,-0.222 0.263,-0.376 0.493,-0.371c0.231,0.004 0.428,0.166 0.478,0.391c0.379,1.695 1.643,3.338 3.556,3.001c0.33,-0.058 0.654,-0.223 0.907,-0.438c0.778,-0.66 1.19,-1.617 1.446,-2.583c0.071,-0.266 0.345,-0.425 0.612,-0.355c0.267,0.071 0.426,0.345 0.355,0.612c-0.308,1.161 -0.83,2.295 -1.765,3.089c-0.385,0.326 -0.88,0.572 -1.381,0.66c-1.943,0.342 -3.43,-0.818 -4.218,-2.393c-0.307,0.655 -0.719,1.255 -1.282,1.733c-0.384,0.326 -0.88,0.572 -1.381,0.66c-1.948,0.343 -3.437,-0.825 -4.224,-2.407c-0.306,0.65 -0.717,1.245 -1.275,1.719c-0.384,0.327 -0.88,0.572 -1.381,0.661c-1.938,0.341 -3.421,-0.812 -4.211,-2.38c-0.307,0.66 -0.722,1.266 -1.288,1.747c-0.385,0.326 -0.88,0.572 -1.381,0.66c-2.479,0.436 -4.215,-1.572 -4.706,-3.768c-0.06,-0.27 0.11,-0.537 0.379,-0.597c0.27,-0.061 0.537,0.109 0.597,0.379c0.379,1.695 1.643,3.338 3.556,3.001c0.33,-0.058 0.654,-0.223 0.907,-0.438c0.764,-0.648 1.174,-1.581 1.432,-2.529Z"
                style="fill:#32b2ff;" />
            <path
                d="M8.622,4.953c0.022,-0.234 0.205,-0.424 0.443,-0.45c0.253,-0.028 0.487,0.139 0.543,0.388c0.378,1.695 1.642,3.338 3.556,3.002c0.329,-0.058 0.654,-0.223 0.907,-0.438c0.778,-0.661 1.189,-1.617 1.446,-2.583c0.064,-0.243 0.299,-0.4 0.548,-0.368c0.237,0.031 0.417,0.225 0.434,0.461c0.39,1.678 1.649,3.289 3.545,2.955c0.33,-0.058 0.654,-0.223 0.907,-0.438c0.778,-0.66 1.19,-1.617 1.446,-2.583c0.059,-0.222 0.263,-0.376 0.493,-0.371c0.231,0.004 0.428,0.166 0.478,0.391c0.379,1.695 1.643,3.338 3.556,3.001c0.33,-0.058 0.654,-0.223 0.907,-0.438c0.778,-0.66 1.19,-1.617 1.446,-2.583c0.071,-0.266 0.345,-0.425 0.612,-0.355c0.267,0.071 0.426,0.345 0.355,0.612c-0.308,1.161 -0.83,2.295 -1.765,3.089c-0.385,0.326 -0.88,0.572 -1.381,0.66c-1.943,0.342 -3.43,-0.818 -4.218,-2.393c-0.307,0.655 -0.719,1.255 -1.282,1.733c-0.384,0.326 -0.88,0.572 -1.381,0.66c-1.948,0.343 -3.437,-0.825 -4.224,-2.407c-0.306,0.65 -0.717,1.245 -1.275,1.719c-0.384,0.327 -0.88,0.572 -1.381,0.661c-1.938,0.341 -3.421,-0.812 -4.211,-2.38c-0.307,0.66 -0.722,1.266 -1.288,1.747c-0.385,0.326 -0.88,0.572 -1.381,0.66c-2.479,0.436 -4.215,-1.572 -4.706,-3.768c-0.06,-0.27 0.11,-0.537 0.379,-0.597c0.27,-0.061 0.537,0.109 0.597,0.379c0.379,1.695 1.643,3.338 3.556,3.001c0.33,-0.058 0.654,-0.223 0.907,-0.438c0.764,-0.648 1.174,-1.581 1.432,-2.529Z"
                style="fill:#32b2ff;" />
            </symbol>
        <symbol id="bullet" viewBox="0 0 18 18">
            <circle cx="9" cy="9" r="2" fill="#FFFFFF" fill-rule="evenodd"/>
        </symbol>
        <symbol id="expl1" viewBox="0 0 22.778 22.778">
            <g>
                <polygon style="fill:#000;" points="17.931,15.433 18.83,10.328 14.412,12.625 12.438,8.625 10.468,12.616 6.05,10.269 
                        			6.912,15.437 2.098,16.137 4.685,18.66 5.68,18.66 3.59,16.622 7.713,16.021 6.967,11.542 10.773,13.566 12.438,10.193 
                        			14.103,13.568 17.903,11.593 17.122,16.017 21.285,16.622 19.196,18.66 20.19,18.66 22.778,16.137 		" />
                <polygon style="fill:#000;" points="16.322,16.545 16.95,12.977 13.84,14.594 12.427,11.732 11.02,14.583 7.917,12.935 
                        			8.518,16.548 5.119,17.042 6.777,18.66 8.766,18.66 8.102,18.012 10.121,17.718 9.748,15.481 11.631,16.483 12.427,14.87 
                        			13.222,16.479 15.095,15.507 14.704,17.714 16.752,18.012 16.088,18.66 18.076,18.66 19.737,17.042 		" />
                <path style="fill:#FF0000;"
                    d="M12.438,17.909c-0.503,0-0.91,0.408-0.91,0.911h1.822C13.35,18.316,12.942,17.909,12.438,17.909z" />
                <polygon style="fill:#000;" points="17.915,3.958 14.888,10.515 15.382,10.72 		" />
                <polygon style="fill:#000;" points="5.694,14.399 0,9.958 5.348,14.809 		" />
                <polygon style="fill:#000;" points="21.633,11.866 19.072,14.083 19.453,14.458 		" />
                <polygon style="fill:#000;" points="10.303,10.5 8.866,7.43 9.801,10.688 		" />
            </g>
        </symbol>
        <symbol id="expl2" viewBox="0 0 22.778 22.778">
            <g>
                <polygon style="fill:#000;"
                    points="17.931,15.433 18.83,10.328 14.412,12.625 12.438,8.625 10.468,12.616 6.05,10.269 
                                6.912,15.437 2.098,16.137 4.685,18.66 5.68,18.66 3.59,16.622 7.713,16.021 6.967,11.542 10.773,13.566 12.438,10.193 
                                14.103,13.568 17.903,11.593 17.122,16.017 21.285,16.622 19.196,18.66 20.19,18.66 22.778,16.137 		" />
                <polygon style="fill:#FFA500;"
                    points="16.322,16.545 16.95,12.977 13.84,14.594 12.427,11.732 11.02,14.583 7.917,12.935 
                                8.518,16.548 5.119,17.042 6.777,18.66 8.766,18.66 8.102,18.012 10.121,17.718 9.748,15.481 11.631,16.483 12.427,14.87 
                                13.222,16.479 15.095,15.507 14.704,17.714 16.752,18.012 16.088,18.66 18.076,18.66 19.737,17.042 		" />
                <path style="fill:#FF0000;"
                    d="M12.438,17.909c-0.503,0-0.91,0.408-0.91,0.911h1.822C13.35,18.316,12.942,17.909,12.438,17.909z" />
                <polygon style="fill:#000;" points="17.915,3.958 14.888,10.515 15.382,10.72 		" />
                <polygon style="fill:#000;" points="5.694,14.399 0,9.958 5.348,14.809 		" />
                <polygon style="fill:#000;" points="21.633,11.866 19.072,14.083 19.453,14.458 		" />
                <polygon style="fill:#000;" points="10.303,10.5 8.866,7.43 9.801,10.688 		" />
            </g>
        </symbol>
        <symbol id="expl3" viewBox="0 0 22.778 22.778">
            <g>
                <polygon style="fill:#FFFF00;"
                    points="17.931,15.433 18.83,10.328 14.412,12.625 12.438,8.625 10.468,12.616 6.05,10.269 
                                6.912,15.437 2.098,16.137 4.685,18.66 5.68,18.66 3.59,16.622 7.713,16.021 6.967,11.542 10.773,13.566 12.438,10.193 
                                14.103,13.568 17.903,11.593 17.122,16.017 21.285,16.622 19.196,18.66 20.19,18.66 22.778,16.137 		" />
                <polygon style="fill:#FFA500;"
                    points="16.322,16.545 16.95,12.977 13.84,14.594 12.427,11.732 11.02,14.583 7.917,12.935 
                                8.518,16.548 5.119,17.042 6.777,18.66 8.766,18.66 8.102,18.012 10.121,17.718 9.748,15.481 11.631,16.483 12.427,14.87 
                                13.222,16.479 15.095,15.507 14.704,17.714 16.752,18.012 16.088,18.66 18.076,18.66 19.737,17.042 		" />
                <path style="fill:#FF0000;"
                    d="M12.438,17.909c-0.503,0-0.91,0.408-0.91,0.911h1.822C13.35,18.316,12.942,17.909,12.438,17.909z" />
                <polygon style="fill:#FF0;" points="17.915,3.958 14.888,10.515 15.382,10.72 		" />
                <polygon style="fill:#FF0;" points="5.694,14.399 0,9.958 5.348,14.809 		" />
                <polygon style="fill:#FF0;" points="21.633,11.866 19.072,14.083 19.453,14.458 		" />
                <polygon style="fill:#FF0;" points="10.303,10.5 8.866,7.43 9.801,10.688 		" />
            </g>
        </symbol>
    </svg>
    <title>Танчики</title>
</head>
<body>
    <h1>ТАНЧИКИ</h1>
    <div class ="game-window">
        <svg id="game-field" height="800px" width="800px"></svg>
    </div>
    <div class="interface">
        <svg id="game-interface" height="50px" width="800px"></svg>
    </div>
    <div class="info">
        <h2>Управление</h2>
        <p>Игрок 1: Стрелочки и Enter</p>
        <p>Игрок 2: WASD и Space</p>
        <h2 class="drops">Плюшки</h2>
        <table>
            <tr>
                <td width="70px">
                    <svg class="info-img">
                        <use xlink:href="#heart"></use>
                    </svg>
                </td>
                <td>
                    <p>Дополнительная жизнь.</p>
                    <p>(Нельзя иметь больше 4 сердечек)</p>
                </td>
            </tr>
            <tr>
                <td width="70px">
                    <svg class="info-img">
                        <use xlink:href="#bomba"></use>
                    </svg>
                </td>
                <td>
                    <p>Бомба. Мгновенно взрывает врага.</p>
                </td>
            </tr>
        </table>
    </div>
    <script>

class Tank{
    constructor(props){
        this.x = props.x;
        this.y = props.y;
        this.speed={x:0, y:0};
        this.hp = 3;
        this.id = props.id;
        this.rotate = props.rotate;
        this.source = newSvg("#tank-"+this.rotate, this.x, this.y, block_size);
        this.source.classList.add("tank"+this.id);
        this.keys = props.keys;
        this.cooldown = null;
        this.shoot_cooldown =null;
        var tank = this;
        document.addEventListener('keydown', function (event) {
            if (event.keyCode == tank.keys.up || event.keyCode == tank.keys.down ||
                event.keyCode == tank.keys.left || event.keyCode == tank.keys.right || 
                event.keyCode == tank.keys.shoot) {
                if (!keyPressed[event.keyCode]) // если кнопка не была зажата
                {
                    clearInterval(tank.cooldown); // сбрасываем перезарядку (для возможности мгновенного поворота)
                    tank.cooldown = null;         // иначе игроку придется попадать в ритм таймера
                }
                keyPressed[event.keyCode] = true;
            }
            event.preventDefault();
        });
    }
    setSpeed(props){
        this.speed = {x: props.x * tank_speed, y: props.y * tank_speed};
    }
    setPosition(coord){
        this.x = coord.x;
        this.y = coord.y;
        this.source.setAttribute('x', this.x);
        this.source.setAttribute('y', this.y);
    }
    move(){
        var t = this;
        let count = 0;
        if (keyPressed[t.keys.up])
            count++;
        if (keyPressed[t.keys.down])
            count++;
        if (keyPressed[t.keys.left])
            count++;
        if (keyPressed[t.keys.right])
            count++;
        
        var rotate;
        if (t.cooldown == null) {
            if (count <= 1) {
                this.setSpeed({ x: 0, y: 0 });

                if (keyPressed[t.keys.up]) {
                    if (t.rotate != "up")
                        rotate = "up" // повернуть танк, если он не был повёрнут
                    else{ // иначе задаем скорость
                            this.setSpeed({ x: 0, y: -1 });
                        }
                }

                if (keyPressed[t.keys.left]) {
                    if (t.rotate != "left")
                        rotate = "left";
                    else{
                            this.setSpeed({ x: -1, y: 0 });;
                        }

                }

                if (keyPressed[t.keys.down]) {
                    if (t.rotate != "down")
                        rotate = "down";
                    else{
                            this.setSpeed({ x: 0, y: 1 });
                        }
                }

                if (keyPressed[t.keys.right]) {
                    if (t.rotate != "right")
                        rotate = "right";
                    else{
                            this.setSpeed({ x: 1, y: 0 });
                        }
                }
                if (rotate)
                    this.rotate = rotate;
            }
            if (keyPressed[t.keys.shoot] && t.shoot_cooldown == null) {
                let x, y, speed;
                switch (this.rotate) {
                    case "up":
                        x = this.x;
                        y = this.y - block_size / 2;
                        speed = { x: 0, y: -5 }
                        break;
                    case "down":
                        x = this.x;
                        y = this.y + block_size / 2;
                        speed = { x: 0, y: 5 }
                        break;
                    case "left":
                        x = this.x - block_size / 2;
                        y = this.y;
                        speed = { x: -5, y: 0 }
                        break;
                    case "right":
                        x = this.x + block_size / 2;
                        y = this.y;
                        speed = { x: 5, y: 0 }
                        break;
                    default: speed = { x: 0, y: 0 };
                }
                let source = newSvg("#bullet", x, y, block_size);
                bullets.push({ source: source, x: x, y: y, speed: speed });
                document.getElementById("game-field").appendChild(source);
                t.shoot_cooldown = setTimeout(() => {
                    clearTimeout(t.shoot_cooldown);
                    t.shoot_cooldown = null;
                }, 200);
            }

            this.cooldown = setTimeout(() => {
                clearTimeout(this.cooldown);
                this.cooldown = null;
            }, 30);

            if (!this.checkCollision()) {
                this.setPosition({ x: this.x + this.speed.x, y: this.y + this.speed.y });
                this.source.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', "#tank-" + this.rotate);
            }
        }
        this.checkItem();
    }
    checkCollision(){
        let centerX = this.x + this.speed.x +block_size/2;
        let centerY = this.y + this.speed.y +block_size/2;
        let rad = 4*block_size/20; //4 - радиус svg кружка танка, 20 - размер svg поля танка; block_size/20 - масштабирование
        let collision = false;
        for (let tank of tanks){
            if (collision)
                break;
            if (tank != this)           
                collision = Math.pow(centerX -(tank.x +block_size/2), 2) + Math.pow(centerY -(tank.y +block_size/2), 2) <= Math.pow(rad*2, 2);// (x1 - x2)^2 + (y1 - y2)^2 <= R^2
        }
        for (let bar of barriers){
            if (collision)
                break;
            let x1 = Math.abs(bar.x - centerX) -block_size;
            let x2 = Math.abs(bar.x + block_size - centerX) -block_size;
            let y1 = Math.abs(bar.y - centerY) -block_size;
            let y2 = Math.abs(bar.y + block_size - centerY) - block_size;
            collision = ((x1<=rad)&&(x2<=rad)&&(y1<=rad)&&(y2<=rad));
        }
        collision ||= ((centerY - block_size/2<0) || (centerY > map_size - block_size/2)|| (centerX -block_size/2 < 0)||(centerX > map_size - block_size/2))
        return collision;
    }
    checkItem(){
        let centerX = this.x + this.speed.x +block_size/2;
        let centerY = this.y + this.speed.y +block_size/2;
        let rad = 4*block_size/20;
        for (let i=0; i<items.length;i++){
            let it = items[i];
            let x1 = Math.abs(it.x - centerX) -block_size;
            let x2 = Math.abs(it.x + block_size - centerX) -block_size;
            let y1 = Math.abs(it.y - centerY) -block_size;
            let y2 = Math.abs(it.y + block_size - centerY) - block_size;
            if ((x1<=rad)&&(x2<=rad)&&(y1<=rad)&&(y2<=rad)){
                switch(it.type){
                    case "heart": 
                        if(this.hp<5)
                            this.hp++;
                        break;
                    case "bomba":
                        for (let tank of tanks)
                            if (tank != this){
                                explode(tank.x, tank.y);
                                reviveTank(tank);
                            }
                        break;
                }
                it.source.remove();
                items.splice(i,1);
                i--;
            }
        }
    }
}
const block_size = 80;
const map_size = 800;
const tank_speed = 5;
var tanks = [];

// запоминание нажатий кнопок клавиатуры
var keyPressed = new Array(256);
keyPressed.fill(false);
const drop_cooldown = 15000; // таймер появления предметов
const expl_frames = 4; // количество кадров на отрисовку взрыва

/* начальная игровая карта 10х10
 0 - пустое пространство
 1, 2 - игрок 1 или 2
 3 - стена
 4 - трава
 5 - вода
*/
var game_map=[
	[0,0,0,0,0,2,0,0,0,0],
	[0,0,0,0,0,0,5,5,0,0],
	[0,3,4,0,0,0,5,5,0,0],
	[4,3,0,4,0,0,0,0,0,0],
	[4,3,0,3,5,3,3,0,3,0],
	[4,0,0,0,0,4,0,0,3,0],
	[4,0,0,0,0,3,3,0,3,0],
	[0,3,3,0,0,0,3,0,0,0],
	[0,3,3,0,0,0,0,0,0,0],
	[0,4,0,0,1,0,0,0,0,0],
];
var barriers = []; // контейнер для хранинения препятствий из game_map
var explosions = []; // контейнер для отрисовки взрывов
var items =[]; // контейнер для отрисовки предметов
var bullets = []; // контейнер для слежки за снарядами

//запуск игры, основные функции перерисовки и анализа передвижений
    createScene();
    requestAnimationFrame(function game(){
        drawInterface();
        moveTanks();
        moveBullets();
        controlExplosions();
        requestAnimationFrame(game);
    });
    setTimeout(() => generateItem(), drop_cooldown);


document.addEventListener('keyup', function (event){
	keyPressed[event.keyCode] = false;
				
});

function moveTanks(){
    for (let tank of tanks)
        tank.move();
}

// возрождение игрока в новом месте
function reviveTank(player){
    var copy_map = game_map.map(function(x){ return new Array(x.length).fill(0);});
    player.hp = 3;
    // составляем примерную текущую карту, чтобы не воскресить игрока в объекте
    for (let it of barriers){
        let x = Math.floor(it.x / block_size);
        let y = Math.floor(it.y / block_size);
        copy_map[y][x] = 1;
    }
    for (let it of bullets){
        let x = Math.floor(it.x / block_size);
        let y = Math.floor(it.y / block_size);
        copy_map[y][x] = 1;
    }
    for (let it of tanks){
        let x = Math.floor(it.x / block_size);
        let y = Math.floor(it.y / block_size);
        copy_map[y][x] = 1;
    }
    for (let it of items){
        let x = Math.floor(it.x / block_size);
        let y = Math.floor(it.y / block_size);
        copy_map[y][x] = 1;
    }
    var x = Math.floor(Math.random() * game_map.length);
	var y = Math.floor(Math.random() * game_map.length);
	while (copy_map[y][x]!=0)
	{
		x = Math.floor(Math.random() * game_map.length);
		y = Math.floor(Math.random() * game_map.length);
	}
    x *= block_size;
    y *= block_size;
    player.setPosition({x:x, y:y});
}

// рисование нижнего интерфейса
function drawInterface()
{
    const block_size2 = 40;
    let x=5;
    let y=5;
    let p1 = getTankById(1);
    let p2 = getTankById(2);
    let svgInterf = document.getElementById("game-interface");
    while (svgInterf.firstChild) {
        svgInterf.removeChild(svgInterf.lastChild);
    }
    let useSvg = newSvg("#tank-right", x, y, block_size2);
    useSvg.classList.add("tank1");
    svgInterf.appendChild(useSvg);
    
    for(let i=1; i<p1.hp;i++){
        x += block_size2 +5;
        svgInterf.appendChild(newSvg('#heart', x, y, block_size2));
    }

    x = 800 -5 -block_size2;
    useSvg = newSvg("#tank-left", x, y, block_size2);
    useSvg.classList.add("tank2");;
    svgInterf.appendChild(useSvg);

    for(let i=1; i<p2.hp;i++){
        x -= block_size2 +5;
        svgInterf.appendChild(newSvg('#heart', x, y, block_size2));
    }
}
function explode(x, y){
    source = newSvg("#expl1", x, y, block_size);
    explosions.push({type: 1, frames: expl_frames, source: source});
    document.getElementById("game-field").appendChild(source);
}
function controlExplosions()
{
    for(let i=0; i<explosions.length;i++){
        let expl = explosions[i];
        switch (expl.type){
            case 1: 
                expl.frames--;
                if (expl.frames<=0) {
                    expl.source.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', "#expl2");
                    expl.type = 2;
                    expl.frames = expl_frames;
                }
                break;
            case 2: 
                expl.frames--;
                if (expl.frames<=0) {
                    expl.source.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', "#expl3");
                    expl.type = 3;
                    expl.frames = expl_frames;
                }
                break;
            case 3: 
                expl.frames--;
                if (expl.frames<=0) {
                    expl.source.remove();
                    explosions.splice(i,1);
                    i--;
                }
                break;
        }
    }
}
// раз в некоторое время добавляется предмет на поле
function generateItem(){
    if (items.length < 3) {
        // заполняем копию текущей карты всеми объектами, чтобы новый предмет не появился на месте чего-то другого
        var copy_map = game_map.map(function (x) { return new Array(x.length).fill(0); });
        // составляем примерную текущую карту, чтобы не воскресить игрока в объекте
        for (let it of barriers) {
            let x = Math.floor(it.x / block_size);
            let y = Math.floor(it.y / block_size);
            copy_map[y][x] = 1;
        }
        for (let it of bullets) {
            let x = Math.floor(it.x / block_size);
            let y = Math.floor(it.y / block_size);
            copy_map[y][x] = 1;
        }
        for (let it of tanks) {
            let x = Math.floor(it.x / block_size);
            let y = Math.floor(it.y / block_size);
            copy_map[y][x] = 1;
        }
        for (let it of items) {
            let x = Math.floor(it.x / block_size);
            let y = Math.floor(it.y / block_size);
            copy_map[y][x] = 1;
        }
        var x = Math.floor(Math.random() * game_map.length);
        var y = Math.floor(Math.random() * game_map.length);
        while (copy_map[y][x] != 0) {
            x = Math.floor(Math.random() * game_map.length);
            y = Math.floor(Math.random() * game_map.length);
        }
        x *= block_size;
        y *= block_size;
        let types = ["heart", "bomba"];
        let type = types[Math.floor(Math.random() * types.length)];
        var source = newSvg("#" + type, x, y, block_size);
        items.push({ type: type, x: x, y: y, source: source });
        document.getElementById("game-field").appendChild(source);
    }
    setTimeout(() => generateItem(), drop_cooldown);
}

// создаем <use> в который помещаем переданный svg (source - id тега <symbol> в разметке)
function newSvg(source, x, y, size){
    let useSvg = document.createElementNS('http://www.w3.org/2000/svg', 'use');
    useSvg.setAttribute('x', x);
    useSvg.setAttribute('y', y);
    useSvg.setAttribute('width', size);
    useSvg.setAttribute('height', size);
    useSvg.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', source);
    return useSvg;
}

function createScene(){
    let field = document.getElementById("game-field");
    
    for (var i = 0; i < game_map.length; i++)
		for (var j = 0; j < game_map.length; j++) {
			if (game_map[i][j] === 1){
                var t = new Tank({
                    x: j*block_size,
                    y: i*block_size,
                    keys: {
                        left: 37,
                        up: 38,
                        right: 39,
                        down: 40,
                        shoot: 13
                    },
                    id: 1,
                    rotate: "up"
                });
                tanks.push(t);
            }
			if (game_map[i][j] === 2) 
			{
				var t = new Tank({
                    x: j*block_size,
                    y: i*block_size,
                    id: 2,
                    keys: {
                        left: 65,
                        up: 87,
                        right: 68,
                        down: 83,
                        shoot: 32
                    },
                    rotate: "down"
                });
                tanks.push(t);
			}
			if (game_map[i][j] ===3)
			{
				field.appendChild(createBarrier("wall", j*block_size, i*block_size));
			}
			if (game_map[i][j] === 4)
			{
                field.appendChild(createBarrier("grass", j*block_size, i*block_size));
			}
			if (game_map[i][j] === 5)
			{
                field.appendChild(createBarrier("water", j*block_size, i*block_size));	
			}
        }
        for (let tank of tanks)
            field.appendChild(tank.source);
}
function createBarrier(bar, x, y){
    var newUse = newSvg('#'+bar, x, y, block_size);
    barriers.push({
        source: newUse,
        x: x,
        y: y,
        type: bar
    });
    return newUse;
}
function moveBullets(){
    for(var i=0;i<bullets.length;i++){
        let b1 = bullets[i];
        let centerX = b1.x + block_size/2;
        let centerY = b1.y + block_size/2;
        let rad = 2*block_size/18;
        let collision = false;
        // проверка столкновения с другими снарядами
        for (var j = i+1; j < bullets.length; j++) {
            let b2 = bullets[j];
            let centerX2 = b2.x + block_size / 2;
            let centerY2 = b2.y + block_size / 2;
            collision = Math.pow(centerX - centerX2, 2) + Math.pow(centerY - centerY2, 2) <= Math.pow(2 * rad, 2);
            if (collision) {
                b2.source.remove();
                bullets.splice(j, 1);
                explode(b1.x + b1.speed.x, b1.y + b1.speed.y);
                break;
            }
        }
        // проверка столкновения с препятствиями
        if (!collision){
            var hit;
            var j;
            for (j = 0; j<barriers.length;j++){
                var bar = barriers[j];
                let x1 = Math.abs(bar.x - centerX) -block_size;
                let x2 = Math.abs(bar.x + block_size - centerX) -block_size;
                let y1 = Math.abs(bar.y - centerY) -block_size;
                let y2 = Math.abs(bar.y + block_size - centerY) - block_size;
                collision = ((x1<=rad)&&(x2<=rad)&&(y1<=rad)&&(y2<=rad));
                if (collision){
                    switch (barriers[j].type) {
                        case "wall": j=barriers.length+1;
                            break;
                        case "water":
                            collision = false;
                            break;
                        case "grass":
                            barriers[j].source.remove();
                            barriers.splice(j, 1);
                            j=barriers.length+1;
                            break;
                    }
                }
            }
        }
        // проверка столкновения с танками
        if (!collision){
            for (let tank of tanks){
                let centerX2 = tank.x + block_size/2;
                let centerY2 = tank.y + block_size/2;
                let rad2 = 4*block_size/20;
                collision = Math.pow(centerX - centerX2, 2) + Math.pow(centerY - centerY2, 2) <= Math.pow(rad + rad2, 2);
                if (collision){
                    tank.hp--;
                    if (tank.hp<=0){
                        explode(tank.x, tank.y);
                        reviveTank(tank);
                    }
                    break;
                }
            }
        }
        if (!collision){
            b1.x += b1.speed.x;
            b1.y += b1.speed.y;
            b1.source.setAttribute('x', b1.x);
            b1.source.setAttribute('y', b1.y);
            if (centerX < 0 || centerX > map_size || centerY < 0 || centerY > map_size) {
                collision = true;
            }
        }
        if (collision){
            b1.source.remove();
            bullets.splice(i, 1);
            i--;
        }
    }
    
}
function getTankById(id){
    for (var tank of tanks)
        if (tank.id == id)
            return tank;
}
    </script>
</body>
</html>